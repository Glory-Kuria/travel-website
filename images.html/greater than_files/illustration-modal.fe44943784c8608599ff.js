(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1460:function(t,e,r){"use strict";r(15),r(12),r(13),r(6),r(17),r(14),r(18);var n=r(7),o=r(4),l=(r(47),r(27));function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function d(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}e.a={data:function(){return{gettingSameStyleIllustrations:!0,gettingRelatedCategories:!0,relatedCategories:[],sameStyleIllustrations:[],totalRelatedCategories:0,totalSameStyle:0}},computed:d({},Object(l.e)({userId:function(t){var e;return(null===(e=t.auth.user)||void 0===e?void 0:e.id)||""}})),methods:{getSimilarsAndRelated:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getSameStyleIllustrations(),null!==(r=t.illustration)&&void 0!==r&&r.id){e.next=4;break}return t.gettingRelatedCategories=!1,e.abrupt("return");case 4:t.getRelatedCategories(),t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},getSameStyleIllustrations:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,l,c,h,f,v,m,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=t.illustration)&&void 0!==r&&null!==(n=r.styles)&&void 0!==n&&n.length){e.next=3;break}return t.gettingSameStyleIllustrations=!1,e.abrupt("return");case 3:return l=t.illustration.styles[0].pretty_id,c={page:1,per_page:50,style_pretty_ids:l,locale:t.locale},h=d(d({},c),{},{id:t.illustration.id,userId:t.userId,type:"similars"}),t.gettingSameStyleIllustrations=!0,e.prev=7,e.next=10,t.$store.dispatch("cache/get",{key:h});case 10:if(!(m=e.sent)){e.next=15;break}o=m,e.next=20;break;case 15:return y=t.illustration.id,e.next=18,t.$illustrationsRepository.show(y,c,"similars");case 18:o=e.sent,t.$store.dispatch("cache/set",{key:h,value:o});case 20:t.sameStyleIllustrations=(null===(f=o)||void 0===f?void 0:f.illustrations)||[],t.totalSameStyle=(null===(v=o)||void 0===v?void 0:v.total)||0,e.next=27;break;case 24:e.prev=24,e.t0=e.catch(7),console.error(e.t0);case 27:return e.prev=27,t.gettingSameStyleIllustrations=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[7,24,27,30]])})))()},getRelatedCategories:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,l,c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={related_illustration_id:t.illustration.id,page:1,per_page:8,random_previews_count:4,locale:t.locale},o=d(d({},n),{},{keyType:"related"}),t.gettingRelatedCategories=!0,e.prev=3,e.next=6,t.$store.dispatch("cache/get",{key:o});case 6:if(!(h=e.sent)){e.next=11;break}r=h,e.next=15;break;case 11:return e.next=13,t.$categoriesPreviewsRepository.index(n);case 13:r=e.sent,t.$store.dispatch("cache/set",{key:o,value:r});case 15:t.relatedCategories=(null===(l=r)||void 0===l?void 0:l.categories)||[],t.totalRelatedCategories=(null===(c=r)||void 0===c?void 0:c.total)||0,e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),console.error(e.t0);case 22:return e.prev=22,t.gettingRelatedCategories=!1,e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,19,22,25]])})))()}}}},1488:function(t,e,r){var content=r(1586);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(10).default)("f749b3b0",content,!0,{sourceMap:!1})},1489:function(t,e,r){var content=r(1588);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(10).default)("8379ba48",content,!0,{sourceMap:!1})},1585:function(t,e,r){"use strict";r(1488)},1586:function(t,e,r){var n=r(9)((function(i){return i[1]}));n.push([t.i,".illustration-modal{max-width:1144px;width:100%}.illustration-modal>.modal-close{right:-60px;top:16px}@media(max-width:1300px){.illustration-modal>.modal-close{left:10px;top:10px!important}}@media(max-width:400px){.illustration-modal>.modal-close{height:32px;width:32px}}",""]),n.locals={},t.exports=n},1587:function(t,e,r){"use strict";r(1489)},1588:function(t,e,r){var n=r(9)((function(i){return i[1]}));n.push([t.i,".body[data-v-5ed3e410]{background-color:#fff;max-height:100%;position:relative;width:100%}@media(max-width:550px){.body[data-v-5ed3e410]{order:2;width:100%}}@media(min-width:1144px){.i8-scroll[data-v-5ed3e410]>.full-illustration{box-shadow:0 0 1px rgba(96,96,96,.31),0 12px 24px -6px rgba(96,96,96,.15);position:relative}}.i8-scroll[data-v-5ed3e410]::-webkit-scrollbar{display:none}",""]),n.locals={},t.exports=n},1669:function(t,e,r){"use strict";r.r(e);r(15),r(12),r(13),r(17),r(14),r(18);var n=r(7),o=r(4),l=(r(6),r(20),r(47),r(27)),c=r(475);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f={name:"OuchIllustrationModal",mixins:[r(1460).a],data:function(){return{hasFullInfo:!1,hasPrev:!1,hasNext:!1,illustration:null,illustrationsHistory:[],initialPath:null,initialTitle:"",isAnimated:!1,loading:!0,locale:this.$i18n.localeProperties.iso,scrollTop:0,thumbImage:null,windowHeight:0}},computed:h({},Object(l.e)({modalActive:function(t){return t.modalActive},illustrationIndexOffset:function(t){return t.illustrationIndexOffset},userId:function(t){var e;return(null===(e=t.auth.user)||void 0===e?void 0:e.id)||""},windowWidth:function(t){return t.windowWidth}})),watch:{illustration:function(t){var e=this;t?this.$nextTick((function(){e.$refs.body&&(e.$refs.body.scrollTop=0)})):this.hideToast()}},created:function(){this.isMobile=Object(c.a)()},methods:h(h({},Object(l.b)(["setModalActive","setIllustrationIndexOffset","setIllustrationNavDirection"])),{},{hideToast:function(){var t=document.getElementsByClassName("toast-container");t.length&&(t[0].outerHTML="")},setKeyEvents:function(){window.addEventListener("keydown",this.keyHandler)},removeKeyEvents:function(){window.removeEventListener("keydown",this.keyHandler)},keyHandler:function(t){"ArrowLeft"===t.code&&this.hasPrev&&(this.setIllustrationNavDirection(-1),this.setIllustrationIndexOffset(this.illustrationIndexOffset-1)),"ArrowRight"===t.code&&this.hasNext&&(this.setIllustrationNavDirection(1),this.setIllustrationIndexOffset(this.illustrationIndexOffset+1))},scrollHandler:function(){this.scrollTop=this.$refs.body.scrollTop},modalShown:function(data){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.thumbImage=null==data?void 0:data.thumb,t.setKeyEvents(),t.addScrollToIllustrationBody(),t.freezePageBody(),t.setAppHeight(!0),t.loading=!0,t.modalActive||(t.setModalActive(!0),t.initialPath=t.$route.fullPath,t.initialTitle=document.title),t.sameStyleIllustrations=[],t.relatedStyles=[],t.hasFullInfo=!1,data.illustration){e.next=12;break}return e.abrupt("return");case 12:return t.illustration=data.illustration,e.prev=13,e.next=16,t.loadIllustration(data.illustration);case 16:t.illustration=e.sent,e.next=22;break;case 19:e.prev=19,e.t0=e.catch(13),console.error(e.t0);case 22:return e.prev=22,t.hasFullInfo=!0,e.finish(22);case 25:if(l=data.hasPrev,c=data.hasNext,t.hasPrev=l,t.hasNext=c,t.updateHistoryState(data),document.title="".concat(data.illustration.heading," | Ouch"),null===(r=t.illustration)||void 0===r||null===(n=r.styles)||void 0===n||!n.length||null===(o=t.illustration)||void 0===o||!o.id){e.next=32;break}return e.abrupt("return",t.getSimilarsAndRelated());case 32:t.loading=!1;case 33:case"end":return e.stop()}}),e,null,[[13,19,22,25]])})))()},addScrollToIllustrationBody:function(){var t=this;this.$nextTick((function(){t.scrollTop=0,t.$refs.body&&t.$refs.body.addEventListener("scroll",t.scrollHandler)}))},freezePageBody:function(){document.body.classList.add("is-frozen"),this.isMobile||document.body.classList.add("is-frozen--desktop")},loadIllustration:function(t){var e=this;return new Promise(function(){var r=Object(n.a)(regeneratorRuntime.mark((function r(n){var o,l,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o={locale:e.locale,id:t.id,keyType:"illustration"},r.next=3,e.$store.dispatch("cache/get",{key:o});case 3:if(!(l=r.sent)){r.next=7;break}return n(l),r.abrupt("return");case 7:return r.next=9,e.$illustrationsRepository.show(t.id,o);case 9:c=r.sent,e.$store.dispatch("cache/set",{key:o,value:c}),n(c);case 12:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())},unFreezePageBody:function(){document.body.classList.remove("is-frozen"),document.body.classList.remove("is-frozen--desktop")},updateHistoryState:function(t){var e,r=t.popstate,n=void 0!==r&&r,o=t.illustration;if(null!=o&&o.pretty_id){n||this.illustrationsHistory.push(o);var l="/illustrations/illustration/".concat(o.pretty_id).concat(null!=o&&null!==(e=o.json)&&void 0!==e&&e.url&&this.isAnimated?"--animated":"");window.history.pushState({page:l,title:o.id,id:o.id},o.heading,l)}},onPopStateChange:function(t){var e=this;if(!this.modalActive)return!0;this.$nextTick((function(){var t,r,n;if(1===e.illustrationsHistory.length)return e.$ouchModal.hide("illustration");e.illustrationsHistory.pop();var o=e.illustrationsHistory[e.illustrationsHistory.length-1];e.$ouchModal.show("illustration",{popstate:!0,illustration:o,thumb:{maxWidth:null==o||null===(t=o.preview1x)||void 0===t?void 0:t.width,maxHeight:null==o||null===(r=o.preview1x)||void 0===r?void 0:r.height,url:null==o||null===(n=o.thumb1x)||void 0===n?void 0:n.url}})}))},modalHidden:function(){this.modalActive&&(this.unFreezePageBody(),this.setAppHeight(!1),this.removeKeyEvents(),this.setModalActive(!1),this.illustrationsHistory=[],this.sameStyleIllustrations=[],this.relatedStyles=[],this.illustration=null,this.hasPrev=!1,this.hasNext=!1,this.thumbImage=null,window.history.replaceState(null,null,this.initialPath),document.title=this.initialTitle,this.$refs.body&&this.$refs.body.removeEventListener("scroll",this.scrollHandler))},setAppHeight:function(t){if(!t||this.windowHeight!==window.innerHeight){this.windowHeight=window.innerHeight;var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var r=document.querySelector("html"),body=document.querySelector("body");r.style.height=t?"calc(var(--vh, 1vh) * 100)":"auto",body.style.height=t?"calc(var(--vh, 1vh) * 100)":"auto"}}}),mounted:function(){window.addEventListener("popstate",this.onPopStateChange)},beforeDestroy:function(){window.removeEventListener("popstate",this.onPopStateChange)}},v=f,m=(r(1585),r(1587),r(2)),component=Object(m.a)(v,(function(){var t=this,e=t._self._c;return e("ouch-modal",{attrs:{"affect-scroll":"",name:"illustration",contentClass:"illustration-modal",scrollTop:t.scrollTop},on:{shown:t.modalShown,closed:t.modalHidden},scopedSlots:t._u([{key:"body",fn:function(){return[e("div",{ref:"body",staticClass:"i8-scroll"},[e("ouch-full-illustration",{attrs:{"content-loading":t.gettingSameStyleIllustrations||t.gettingRelatedStyles,"has-full-info":t.hasFullInfo,loading:t.loading,hasNext:t.hasNext,hasPrev:t.hasPrev,illustration:t.illustration,relatedStyles:t.relatedCategories,sameStyleIllustrations:t.sameStyleIllustrations,thumbImage:t.thumbImage,totalSameStyle:t.totalSameStyle,totalRelatedStyles:t.totalRelatedCategories},on:{"animation:change":function(e){t.isAnimated=e}}})],1)]},proxy:!0}])})}),[],!1,null,"5ed3e410",null);e.default=component.exports}}]);